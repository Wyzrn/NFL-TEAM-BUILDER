{% extends 'base.html' %}
{% load static %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/team_detail.css' %}">
{% endblock %}
{% block content %}
  <div class="team-detail-container">
    {% if user.is_authenticated and team.owner == user %}
      <form method="post" class="team-name-form">
        {% csrf_token %}
        <label>
          Team Name:
          <input type="text" name="team_name" value="{{ team.name }}" required>
        </label>
        <button type="submit" class="btn">Save</button>
      </form>
      <a href="{% url 'team-delete' team.id %}" class="btn danger">Delete</a>
    {% else %}
      <h1 class="team-title">{{ team.name }}</h1>
      <p class="team-owner">Owner: {{ team.owner.username }}</p>
    {% endif %}
    <h2 class="roster-title">Roster</h2>
    <ul class="roster-list">
      {% for spot in team.roster_spots.all|dictsort:"slot" %}
        <li class="roster-list-item">
          <span class="roster-slot-label">{{ spot.get_slot_display }}:</span>
          {% if spot.player %}
            {% with spot.player.team|lower|slugify as team_slug %}
              <img src="{% static 'images/' %}{{ team_slug }}-logo.png" width="40" alt="{{ spot.player.team }} logo">
            {% endwith %}
            <span class="roster-player-info">
              {% if spot.player.position == "DEF" %}
                {{ spot.player.name }}
              {% else %}
                {{ spot.player.name }} ({{ spot.player.position }}, {{ spot.player.team }})
              {% endif %}
            </span>
            {% if user.is_authenticated and team.owner == user %}
              <form method="post" action="{% url 'roster-assign' team.id spot.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" name="drop" value="1" class="btn danger" style="margin-left:1em;">Drop</button>
              </form>
            {% endif %}
          {% else %}
            <em>Empty</em>
            {% if user.is_authenticated and team.owner == user %}
              <a href="{% url 'roster-assign' team.id spot.id %}" class="btn">Add Player</a>
            {% endif %}
          {% endif %}
        </li>
      {% endfor %}
    </ul>
    <a href="{% url 'team-index' %}" class="btn secondary">Back to All Teams</a>
  </div>
{% endblock %}